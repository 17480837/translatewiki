#!/bin/bash
WIKINAME=$1
WIKI=$2

cd $WIKI

echo "*** Updating core ***"
git pull --rebase origin master

cd extensions

echo "*** Updating extensions ***"
count=0
for dir in *; do
	if [ -d "$dir" ]; then
		cd $dir
		if [ -d ".git" ]; then
			echo -n "$dir.. ";
			git pull --rebase |grep -v Already &
			let count+=1; [[ $((count%10)) -eq 0 ]] && wait
		fi
		cd ..
	fi
done;

wait
echo -e "\n*** Rebuilding caches ***"
php $WIKI/maintenance/rebuildLocalisationCache.php --threads 12 --quiet &

wait
echo "*** All done ***"
