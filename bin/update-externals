#!/bin/sh
set -e
umask 0002

DIRSCRIPT="`dirname \"$0\"`"
DIRSCRIPT="`( cd \"$DIRSCRIPT\" && pwd )`"

WIKI=/www/translatewiki.net/w

PROJECTS="\
wikia \
blockly \
commons-android \
commons-ios \
eol \
etherpad-lite \
freecol \
fudforum \
fuel \
ihris \
intuition \
jquery.uls \
kiwix \
mantis \
mathjax \
mifos \
mwlib \
okawix \
osm \
pywikibot \
shapado \
vicuna \
waymarked-trails-site \
wikiblame \
WikipediaMobile \
WikipediaMobileJ2ME \
wikireader \
WikisourceMobile \
WiktionaryMobile \
WLMMobile"

echo "Update repositories..."
echo $PROJECTS |
	xargs -n1 -P4 -d ' ' -I % bash -c 'echo "Update %"; ${DIRSCRIPT}/repo update %; echo "Updated %"' bash

echo "All repositories updated"
echo "Create message index..."
${DIRSCRIPT}/createmi
echo "Created message index"

echo "Process message changes..."
php $WIKI/extensions/Translate/scripts/processMessageChanges.php --quiet
echo "Processed message changes"

echo "Go to https://translatewiki.net/wiki/Special:ManageMessageGroups for the last bits"
